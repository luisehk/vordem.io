<label id="id_avatar_container" for="id_avatar_change" class="featured-img center-children" style="cursor: pointer">
  <img id="id_avatar_preview" class="featured-img" src="{{ object.avatar.crop.400x400 }}">
  <div id="id_avatar_preloader" class="lds-dual-ring" style="display: none;"></div>
</label>

<input
  id="id_avatar_change"
  type="file"
  accept="image/*"
  onchange="loadAvatarFile(event);"
  style="display: none;" />

<script>
  var loadAvatarFile = function (event) {
    var reader = new FileReader();
    var preview = $('#id_avatar_preview');
    var preloader = $('#id_avatar_preloader');
    var container = $('#id_avatar_container');

    reader.onload = function(){
      // show preloader
      preview.hide();
      preloader.show();
      container.css('cursor', 'auto');
      container.attr('for', 'none');

      // send image to API
      var csrftoken = getCookie('csrftoken');
      var formData = new FormData();
      formData.append(
        'avatar',
        $('#id_avatar_change')[0].files[0]
      );

      $.ajax({
        url: '{{ object.get_avatar_update_url }}',
        data: formData,
        type: 'PATCH',
        contentType: false,
        processData: false,
        headers: {
          'X-CSRFToken': csrftoken
        },
        success: function(data) {
          preview.attr(
            'src',
            data.avatar.crop__400x400);
        },
        error: function(error) {
          console.log('error changing avatar', error);
        },
        complete: function() {
          preview.show();
          preloader.hide();
          container.css('cursor', 'pointer');
          container.attr('for', 'id_avatar_change');
        }
      });
    };

    reader.readAsDataURL(event.target.files[0]);
  };
</script>
