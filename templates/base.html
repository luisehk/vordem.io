{% load static %}
{% load shipment_notifications_tags %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}">
    <title>Sealed Air - Logistics</title>
    <link rel="stylesheet" type="text/css" href="{% static 'lib/perfect-scrollbar/css/perfect-scrollbar.min.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'lib/material-design-icons/css/material-design-iconic-font.min.css' %}"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="{% static 'lib/jquery.vectormap/jquery-jvectormap-1.2.2.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'lib/jqvmap/jqvmap.min.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'lib/datetimepicker/css/bootstrap-datetimepicker.min.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'lib/datatables/datatables.net-bs4/css/dataTables.bootstrap4.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'lib/jquery.gritter/css/jquery.gritter.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/app.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'css/utils.css' %}" type="text/css"/>
    {% block extra_css %}{% endblock %}
  </head>
  <body onLoad="UserNotificationsConfig()">
    <div class="be-wrapper be-collapsible-sidebar be-collapsible-sidebar-collapsed">
      <nav class="navbar navbar-expand fixed-top be-top-header">
        <div class="container-fluid">
          <div class="be-navbar-header">
            <a href="/" class="navbar-brand"></a>
          </div>
          <div class="be-right-navbar">
            <ul class="nav navbar-nav float-right be-user-nav">
              <li class="nav-item dropdown">
                <a href="#" data-toggle="dropdown" role="button" aria-expanded="false" class="nav-link dropdown-toggle">
                  <img src="{{ request.user.profile.avatar.crop.128x128 }}" alt="Avatar">
                  <span class="user-name">{% firstof request.user.get_full_name request.user.email %}</span>
                </a>

                <div role="menu" class="dropdown-menu">
                  <div class="user-info">
                    <div class="user-name">{% firstof request.user.get_full_name request.user.email %}</div>
                  </div>
                  <!-- <a href="#tab1" role="button" aria-expanded="false" class="dropdown-item be-toggle-right-sidebar">
                    <span class="icon mdi mdi-settings"></span> Ajustes -->
                  </a>
                  <a href="{% url 'account_change_password' %}" class="dropdown-item">
                    <span class="icon mdi mdi-key"></span> Cambiar contraseña
                  </a>
                  <a href="{% url 'account_logout' %}" onclick="return confirm('¿Estás seguro de querer cerrar sesión?');" class="dropdown-item">
                    <span class="icon mdi mdi-power"></span> Cerrar sesión
                  </a>
                </div>
              </li>
            </ul>
            <div class="page-title"><span>Embarques</span></div>
            {% count_notifications as total_notifications %}
            <ul class="nav navbar-nav float-right be-icons-nav">
              <li class="nav-item dropdown"><a href="#" role="button" aria-expanded="false" class="nav-link be-toggle-right-sidebar"><span class="icon mdi mdi-settings"></span></a></li>
              <li class="nav-item dropdown"><a href="#" data-toggle="dropdown" role="button" aria-expanded="false" class="nav-link dropdown-toggle"><span class="icon mdi mdi-notifications"></span>{% if total_notifications > 0 %}<span class="indicator"></span>{% endif %}</a>
                <ul class="dropdown-menu be-notifications">
                  <li>
                      <div class="title">Notificaciones
                        {% if total_notifications > 0 %}
                        <span class="badge badge-pill">{{total_notifications}}</span>
                        {% endif %}
                      </div>
                    <div class="list">
                      <div class="be-scroller">
                        <div class="content">
                          {% all_notifications %}
                          <!--
                          <ul>
                            {% for notification in notifications  %}
                              <li class="notification notification-unread">
                                <a href="#">
                                  <div class="image"><img src="{% static 'img/avatar2.png' %}" alt="Avatar"></div>
                                  <div class="notification-info">
                                      <div class="text"><span class="user-name">{{notification.user.first_name}}</span>
                                        {% if notification.reason == 'NSH' %}
                                          creó el embarque {{notification.shipment }} con destino hacia {{notification.shipment.plant}}.</div>
                                        {% endif %}
                                        <span class="date">Hace 2 minutos</span>
                                  </div>
                                </a>
                              </li>
                            {% empty %}

                            {% endfor %}

                            <li class="notification notification-unread">
                              <a href="#">
                                <div class="image"><img src="{% static 'img/avatar2.png' %}" alt="Avatar"></div>
                                <div class="notification-info">
                                  <div class="text"><span class="user-name">Jessica Caruso</span> creó el embarque #54378 con destino hacia Iowa Park.</div><span class="date">Hace 2 minutos</span>
                                </div>
                              </a>
                            </li>
                            <li class="notification"><a href="#">
                                <div class="image"><img src="{% static 'img/avatar3.png' %}" alt="Avatar"></div>
                                <div class="notification-info">
                                  <div class="text"><span class="user-name">Joel King</span> marcó el embarque #87346 como Entregado.</div><span class="date">Hace 2 días</span>
                                </div></a></li>
                            <li class="notification"><a href="#">
                                <div class="image"><img src="{% static 'img/avatar4.png' %}" alt="Avatar"></div>
                                <div class="notification-info">
                                  <div class="text"><span class="user-name">John Doe</span> cambió el estado del embarque #123456 a: US Carrier.</div><span class="date">Hace 4 días</span>
                                </div></a></li>
                            <li class="notification"><a href="#">
                                <div class="image"><img src="{% static 'img/avatar5.png' %}" alt="Avatar"></div>
                                <div class="notification-info"><span class="text"><span class="user-name">Emily Carter</span> creó el embarque #54378 con destino hacia Saint Joe.</span><span class="date">Hace 5 días</span></div></a></li>
                          </ul>
                          -->
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <div class="be-left-sidebar">
        <div class="left-sidebar-wrapper"><a href="#" class="left-sidebar-toggle">Embarques</a>
          <div class="left-sidebar-spacer">
            <div class="left-sidebar-scroll">
              <div class="left-sidebar-content">
                <ul class="sidebar-elements">
                  <li class="divider">Menu</li>
                  <li class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                    <a href="{% url 'shipments:dashboard' %}" title="Dashboard"><i class="icon mdi mdi-home"></i><span>Dashboard</span></a>
                  </li>
                  <li class="{% if request.resolver_match.url_name == 'shipment-listar' %}active{% endif %}">
                    <a href="{% url 'shipments:shipment-listar' %}" title="Embarques"><i class="fas fa-shipping-fast pr-2"></i><span>Embarques</span>
                    </a>
                  </li>
                  <li class="{% if request.resolver_match.url_name == 'carrier-list' %}active{% endif %}"><a href="{% url 'providers:carrier-list' %}" title="Carriers"><i class="icon mdi mdi-truck"></i><span>Carriers</span></a>
                  </li>
                  <li class="{% if request.resolver_match.url_name == 'plant-list' %}active{% endif %}"><a href="{% url 'company:plant-list' %}" title="Plantas"><i class="fas fa-building pr-3"></i><span>Plantas</span></a>
                  </li>
                  <li class="{% if request.resolver_match.url_name == 'users-list' %}active{% endif %}"><a href="{% url 'users:users-list' %}"><i class="icon mdi mdi-accounts-alt" title="Usuarios"></i><span>Usuarios</span></a>
                  </li>
                  <li><a href="{% url 'shipments:delay-reason-list' %}" title="Razones de retraso"><i class="mdi mdi-labels"></i><span>Razones de retraso</span></a>
                  </li>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="be-content">
        <div class="modal-overlay"></div>
        {% block content %}{% endblock %}
      </div>

      <nav class="be-right-sidebar">
        <div class="sb-content">
          <div class="tab-navigation">
            <ul role="tablist" class="nav nav-tabs nav-justified">
              <li role="presentation" class="nav-item"><a href="#tab1" aria-controls="tab1" role="tab" data-toggle="tab" class="nav-link active">Ajustes</a></li>
            </ul>
          </div>
          <div class="tab-panel">
            <div class="tab-content">
              <div id="tab1" role="tabpanel" class="tab-pane tab-settings active">
                <div class="settings-wrapper">
                  <div class="be-scroller"><span class="category-title">Notificaciones</span>
                    <ul class="settings-list">
                      <li>
                        <div class="switch-button switch-button-sm switch-button-success">
                          <input type="checkbox" checked="" name="new_shipments" id="id_new_shipments"><span>
                            <label for="id_new_shipments"></label></span>
                        </div><span class="name">Nuevos embarques</span>
                      </li>
                      <li>
                        <div class="switch-button switch-button-sm switch-button-success">
                          <input type="checkbox" checked="" name="late_shipment" id="id_late_shipment"><span>
                            <label for="id_late_shipment"></label></span>
                        </div><span class="name">Retrasos</span>
                      </li>
                      <li>
                        <div class="switch-button switch-button-sm switch-button-success">
                          <input type="checkbox" checked="" name="delivered_shipment" id="id_delivered_shipment"><span>
                            <label for="id_delivered_shipment"></label></span>
                        </div><span class="name">Entregas</span>
                      </li>
                    </ul>
                    <span class="category-title">Recibir por</span>

                    <ul class="settings-list">
                      <li>
                        <div class="switch-button switch-button-sm switch-button-success">
                          <input type="checkbox" checked="" name="email" id="id_email"><span>
                            <label for="id_email"></label></span>
                        </div><span class="name">Por correo</span>
                      </li>
                      <li style="display:none;">
                        <div class="switch-button switch-button-sm switch-button-success">
                          <input type="checkbox" name="sms" id="id_sms"><span>
                            <label for="id_sms"></label></span>
                        </div><span class="name">Por SMS</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>
    <script src="{% static 'lib/jquery/jquery.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/bootstrap/dist/js/bootstrap.bundle.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/app.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-flot/jquery.flot.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-flot/jquery.flot.pie.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-flot/jquery.flot.time.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-flot/jquery.flot.resize.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-flot/plugins/jquery.flot.orderBars.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-flot/plugins/curvedLines.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-flot/plugins/jquery.flot.tooltip.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery.sparkline/jquery.sparkline.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/countup/countUp.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery-ui/jquery-ui.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jqvmap/jquery.vmap.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jqvmap/maps/jquery.vmap.world.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/parsley/parsley.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery.gritter/js/jquery.gritter.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/parsley/i18n/es.js' %}"></script>
    <script src="{% static 'lib/jquery-ui/jquery-ui.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/jquery.nestable/jquery.nestable.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/moment.js/min/moment.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/datetimepicker/js/bootstrap-datetimepicker.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jscolor.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/base.js' %}" type="text/javascript"></script>
    {% block extra_scripts %}{% endblock %}
    <script type="text/javascript">
      $(document).ready(function(){
      	//initialize the javascript
      	App.init();
      });

      var user_id = {{request.user.pk}};

      function UserNotificationsConfig(){
        var url = "/api/user-notifications/" + user_id
        $.getJSON(url, function (data) {
            $("#id_new_shipments").prop("checked", data.new_shipment);
            $("#id_late_shipment").prop("checked", data.late_shipment);
            $("#id_delivered_shipment").prop("checked", data.delivered_shipment);
            $("#id_email").prop("checked", data.email);
            $("#id_sms").prop("checked", data.sms);
        });
      }

      function ChangeNotificationsUser(user, key_obj, status) {
        data = {}
        data[key_obj] = status
        $.ajax({
          type: 'PATCH',
          headers: {
            'X-CSRFToken': getCookie('csrftoken')
          },
          url: "/api/user-notifications/" + user + "/",
          data: data,
          success: function (data) {},
          error: function (error) {
            console.log(error);
          }
        });
      }

      $("#id_new_shipments").change(function(){

        if(this.checked != true){
          ChangeNotificationsUser(user_id, 'new_shipment', false);
        } else {
          ChangeNotificationsUser(user_id, 'new_shipment', true);
        }
      })

      $("#id_late_shipment").change(function(){
        if(this.checked != true){
          ChangeNotificationsUser(user_id, 'late_shipment', false);
        } else {
          ChangeNotificationsUser(user_id, 'late_shipment', true);
        }
      })

      $("#id_delivered_shipment").change(function(){
        if(this.checked != true){
          ChangeNotificationsUser(user_id, 'delivered_shipment', false);
        } else {
          ChangeNotificationsUser(user_id, 'delivered_shipment', true);
        }
      })

      $("#id_email").change(function(){
        if(this.checked != true){
          ChangeNotificationsUser(user_id, 'email', false);
        } else {
          ChangeNotificationsUser(user_id, 'email', true);
        }
      })

      $("#id_sms").change(function(){
        if(this.checked != true){
          ChangeNotificationsUser(user_id, 'sms', false);
        } else {
          ChangeNotificationsUser(user_id, 'sms', true);
        }
      })

    </script>
  </body>
</html>
